<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Filtering Test</title>
    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
        }
        .status { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            font-weight: 500; 
        }
        .status-success { 
            background: #d4edda; 
            color: #155724; 
            border: 1px solid #c3e6cb; 
        }
        .status-error { 
            background: #f8d7da; 
            color: #721c24; 
            border: 1px solid #f5c6cb; 
        }
        .status-warning { 
            background: #fff3cd; 
            color: #856404; 
            border: 1px solid #ffeaa7; 
        }
        .status-info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border: 1px solid #bee5eb; 
        }
        .console-simulation {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        .test-btn { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 6px; 
            background: #007bff; 
            color: white; 
            cursor: pointer; 
            font-weight: 500; 
        }
        .test-btn:hover { 
            background: #0056b3; 
        }
        .test-btn:disabled { 
            background: #6c757d; 
            cursor: not-allowed; 
        }
        .test-btn.success { 
            background: #28a745; 
        }
        .test-btn.success:hover { 
            background: #218838; 
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .feature-card h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        .feature-card ul {
            margin: 0;
            padding-left: 20px;
        }
        .feature-card li {
            margin: 5px 0;
            color: #6c757d;
        }
        .filter-demo {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 20px 0;
        }
        .filter-section {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .filter-section h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 16px;
        }
        .filter-option {
            display: flex;
            align-items: center;
            margin: 8px 0;
            cursor: pointer;
        }
        .filter-option input {
            margin-right: 10px;
        }
        .filter-option label {
            cursor: pointer;
            color: #6c757d;
        }
        .results-panel {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #b3d9ff;
            margin: 15px 0;
        }
        .property-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .property-info {
            flex: 1;
        }
        .property-name {
            font-weight: bold;
            color: #495057;
            margin-bottom: 5px;
        }
        .property-details {
            color: #6c757d;
            font-size: 14px;
        }
        .property-price {
            font-weight: bold;
            color: #28a745;
            font-size: 18px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>üîç Property Filtering Test</h1>
        
        <div class="status status-success">
            <strong>Smart Property Filtering:</strong> Real-time filtering based on price, property type, location, guests, and amenities
        </div>

        <div class="feature-grid">
            <div class="feature-card">
                <h4><i class="fas fa-rupee-sign text-success"></i> Price Range Filtering</h4>
                <ul>
                    <li>Under ‚Çπ2,000</li>
                    <li>‚Çπ2,000 - ‚Çπ3,000</li>
                    <li>‚Çπ3,000 - ‚Çπ4,000</li>
                    <li>Above ‚Çπ4,000</li>
                    <li>Real-time price matching</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4><i class="fas fa-home text-info"></i> Property Type Filtering</h4>
                <ul>
                    <li>Villa, Cottage, Resort</li>
                    <li>Estate, Heritage, Retreat</li>
                    <li>Farm House, Camp, Bungalow</li>
                    <li>Loft, Cabin, Palace</li>
                    <li>Exact type matching</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4><i class="fas fa-map-marker-alt text-danger"></i> Location Filtering</h4>
                <ul>
                    <li>Search by destination</li>
                    <li>Partial text matching</li>
                    <li>Case-insensitive search</li>
                    <li>Multiple location fields</li>
                    <li>Auto-complete suggestions</li>
                </ul>
            </div>
            <div class="feature-card">
                <h4><i class="fas fa-users text-warning"></i> Guest & Amenity Filtering</h4>
                <ul>
                    <li>Guest capacity matching</li>
                    <li>1-9+ guest options</li>
                    <li>Amenity requirement checking</li>
                    <li>Multiple amenity selection</li>
                    <li>At least one match logic</li>
                </ul>
            </div>
        </div>

        <div class="filter-demo">
            <h3><i class="fas fa-filter"></i> Filter Testing Interface</h3>
            
            <div class="filter-section">
                <h4><i class="fas fa-rupee-sign"></i> Price Range</h4>
                <div class="filter-option">
                    <input type="radio" id="price-any" name="price" value="" checked onchange="updateFilters()">
                    <label for="price-any">Any price</label>
                </div>
                <div class="filter-option">
                    <input type="radio" id="price-0-2000" name="price" value="0-2000" onchange="updateFilters()">
                    <label for="price-0-2000">Under ‚Çπ2,000</label>
                </div>
                <div class="filter-option">
                    <input type="radio" id="price-2000-3000" name="price" value="2000-3000" onchange="updateFilters()">
                    <label for="price-2000-3000">‚Çπ2,000 - ‚Çπ3,000</label>
                </div>
                <div class="filter-option">
                    <input type="radio" id="price-3000-4000" name="price" value="3000-4000" onchange="updateFilters()">
                    <label for="price-3000-4000">‚Çπ3,000 - ‚Çπ4,000</label>
                </div>
                <div class="filter-option">
                    <input type="radio" id="price-4000+" name="price" value="4000+" onchange="updateFilters()">
                    <label for="price-4000+">Above ‚Çπ4,000</label>
                </div>
            </div>

            <div class="filter-section">
                <h4><i class="fas fa-home"></i> Property Type</h4>
                <div class="filter-option">
                    <input type="radio" id="type-any" name="type" value="" checked onchange="updateFilters()">
                    <label for="type-any">Any type</label>
                </div>
                <div class="filter-option">
                    <input type="radio" id="type-villa" name="type" value="Villa" onchange="updateFilters()">
                    <label for="type-villa">Villa</label>
                </div>
                <div class="filter-option">
                    <input type="radio" id="type-cottage" name="type" value="Cottage" onchange="updateFilters()">
                    <label for="type-cottage">Cottage</label>
                </div>
                <div class="filter-option">
                    <input type="radio" id="type-resort" name="type" value="Resort" onchange="updateFilters()">
                    <label for="type-resort">Resort</label>
                </div>
                <div class="filter-option">
                    <input type="radio" id="type-heritage" name="type" value="Heritage" onchange="updateFilters()">
                    <label for="type-heritage">Heritage</label>
                </div>
            </div>

            <div class="filter-section">
                <h4><i class="fas fa-map-marker-alt"></i> Location</h4>
                <input type="text" id="locationInput" placeholder="Enter location (e.g., Hyderabad, Bangalore)" 
                       style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;" 
                       oninput="updateFilters()">
            </div>

            <div class="filter-section">
                <h4><i class="fas fa-users"></i> Guests</h4>
                <select id="guestsSelect" onchange="updateFilters()" 
                        style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;">
                    <option value="">Any guests</option>
                    <option value="1">1 Guest</option>
                    <option value="2">2 Guests</option>
                    <option value="3">3 Guests</option>
                    <option value="4">4 Guests</option>
                    <option value="5">5 Guests</option>
                    <option value="6">6 Guests</option>
                    <option value="7">7 Guests</option>
                    <option value="8">8 Guests</option>
                    <option value="9+">9+ Guests</option>
                </select>
            </div>

            <div class="filter-section">
                <h4><i class="fas fa-star"></i> Amenities</h4>
                <div class="filter-option">
                    <input type="checkbox" id="amenity-pool" onchange="updateFilters()">
                    <label for="amenity-pool">Pool</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="amenity-wifi" onchange="updateFilters()">
                    <label for="amenity-wifi">WiFi</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="amenity-parking" onchange="updateFilters()">
                    <label for="amenity-parking">Parking</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="amenity-kitchen" onchange="updateFilters()">
                    <label for="amenity-kitchen">Kitchen</label>
                </div>
                <div class="filter-option">
                    <input type="checkbox" id="amenity-ac" onchange="updateFilters()">
                    <label for="amenity-ac">AC</label>
                </div>
            </div>
        </div>

        <div class="results-panel">
            <h4><i class="fas fa-list"></i> Filtered Results</h4>
            <div id="filterResults">
                <p>Select filters to see results...</p>
            </div>
            <div id="filterStats" style="margin-top: 15px; font-size: 14px; color: #6c757d;"></div>
        </div>

        <div class="console-simulation" id="consoleOutput">
            <div>‚úÖ Property Filtering Test Loaded</div>
            <div>üîç Real-time filtering active</div>
            <div>üí∞ Price range filtering ready</div>
            <div>üè† Property type filtering ready</div>
            <div>üìç Location filtering ready</div>
            <div>üë• Guest filtering ready</div>
            <div>‚≠ê Amenity filtering ready</div>
        </div>

        <div class="status status-warning">
            <strong>üîç Test Controls:</strong>
            <div style="margin-top: 10px;">
                <button class="test-btn" onclick="testPriceFiltering()">
                    <i class="fas fa-rupee-sign"></i> Test Price Filtering
                </button>
                <button class="test-btn" onclick="testTypeFiltering()">
                    <i class="fas fa-home"></i> Test Type Filtering
                </button>
                <button class="test-btn" onclick="testLocationFiltering()">
                    <i class="fas fa-map-marker-alt"></i> Test Location Filtering
                </button>
                <button class="test-btn" onclick="testGuestFiltering()">
                    <i class="fas fa-users"></i> Test Guest Filtering
                </button>
                <button class="test-btn" onclick="testAmenityFiltering()">
                    <i class="fas fa-star"></i> Test Amenity Filtering
                </button>
                <button class="test-btn success" onclick="testCombinedFiltering()">
                    <i class="fas fa-filter"></i> Test Combined Filtering
                </button>
                <button class="test-btn" onclick="testPropertiesPage()">
                    <i class="fas fa-external-link-alt"></i> Test Properties Page
                </button>
            </div>
        </div>

        <div class="status status-success">
            <strong>‚úÖ Property Filtering Fixes Applied:</strong>
            <ul>
                <li>‚úÖ <strong>Real-time Filtering:</strong> Filters apply immediately when selected</li>
                <li>‚úÖ <strong>Price Range:</strong> Exact price range matching with proper boundaries</li>
                <li>‚úÖ <strong>Property Type:</strong> Case-insensitive type matching</li>
                <li>‚úÖ <strong>Location Search:</strong> Partial text matching in multiple location fields</li>
                <li>‚úÖ <strong>Guest Capacity:</strong> Proper guest requirement checking</li>
                <li>‚úÖ <strong>Amenity Matching:</strong> At least one amenity requirement logic</li>
                <li>‚úÖ <strong>Sorting:</strong> Price, rating, popularity, and newest sorting</li>
                <li>‚úÖ <strong>Debug Logging:</strong> Detailed console output for troubleshooting</li>
            </ul>
        </div>

        <div class="status status-info">
            <strong>üîç Expected Behavior:</strong>
            <ul>
                <li>‚úÖ <strong>Price Filter:</strong> Select price range to see only properties in that range</li>
                <li>‚úÖ <strong>Type Filter:</strong> Select property type to see only that type</li>
                <li>‚úÖ <strong>Location Filter:</strong> Type location to see matching properties</li>
                <li>‚úÖ <strong>Guest Filter:</strong> Select guests to see properties with sufficient capacity</li>
                <li>‚úÖ <strong>Amenity Filter:</strong> Select amenities to see properties with those features</li>
                <li>‚úÖ <strong>Combined Filters:</strong> Multiple filters work together</li>
                <li>‚úÖ <strong>Real-time Updates:</strong> Results update immediately when filters change</li>
            </ul>
        </div>
    </div>

    <script>
        // Sample property data for testing
        const sampleProperties = [
            {
                id: 1,
                name: "HSR",
                location: "Hyderabad",
                price: 5000,
                type: "Villa",
                guests: 4,
                amenities: ["Pool", "WiFi", "Parking", "Kitchen", "AC"]
            },
            {
                id: 2,
                name: "sevenn hills",
                location: "Kollam",
                price: 3000,
                type: "Resort",
                guests: 6,
                amenities: ["Pool", "WiFi", "Parking", "Garden"]
            },
            {
                id: 3,
                name: "SUPER",
                location: "Kollam",
                price: 2500,
                type: "Cottage",
                guests: 2,
                amenities: ["WiFi", "Kitchen", "AC"]
            },
            {
                id: 4,
                name: "DDD",
                location: "Bangalore",
                price: 2000,
                type: "Heritage",
                guests: 3,
                amenities: ["Parking", "Kitchen", "Fireplace"]
            },
            {
                id: 5,
                name: "Luxury Villa",
                location: "Mumbai",
                price: 8000,
                type: "Villa",
                guests: 8,
                amenities: ["Pool", "WiFi", "Parking", "Kitchen", "AC", "Spa"]
            },
            {
                id: 6,
                name: "Mountain Retreat",
                location: "Himachal Pradesh",
                price: 1500,
                type: "Cottage",
                guests: 2,
                amenities: ["WiFi", "Fireplace", "Mountain View"]
            }
        ];

        let currentFilters = {
            priceRange: '',
            propertyType: '',
            location: '',
            guests: '',
            amenities: []
        };

        function addConsoleLog(message) {
            const consoleOutput = document.getElementById('consoleOutput');
            const logEntry = document.createElement('div');
            logEntry.textContent = message;
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function updateFilters() {
            // Get current filter values
            currentFilters.priceRange = document.querySelector('input[name="price"]:checked')?.value || '';
            currentFilters.propertyType = document.querySelector('input[name="type"]:checked')?.value || '';
            currentFilters.location = document.getElementById('locationInput').value.toLowerCase();
            currentFilters.guests = document.getElementById('guestsSelect').value;
            
            // Get selected amenities
            currentFilters.amenities = [];
            const amenityCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            amenityCheckboxes.forEach(checkbox => {
                if (checkbox.id.startsWith('amenity-')) {
                    currentFilters.amenities.push(checkbox.id.replace('amenity-', ''));
                }
            });

            // Apply filters
            const filteredProperties = sampleProperties.filter(property => {
                // Price range filter
                if (currentFilters.priceRange) {
                    const price = property.price;
                    if (currentFilters.priceRange === '0-2000' && price > 2000) return false;
                    if (currentFilters.priceRange === '2000-3000' && (price < 2000 || price > 3000)) return false;
                    if (currentFilters.priceRange === '3000-4000' && (price < 3000 || price > 4000)) return false;
                    if (currentFilters.priceRange === '4000+' && price < 4000) return false;
                }

                // Property type filter
                if (currentFilters.propertyType && property.type.toLowerCase() !== currentFilters.propertyType.toLowerCase()) {
                    return false;
                }

                // Location filter
                if (currentFilters.location && !property.location.toLowerCase().includes(currentFilters.location)) {
                    return false;
                }

                // Guests filter
                if (currentFilters.guests) {
                    const requiredGuests = currentFilters.guests === '9+' ? 9 : parseInt(currentFilters.guests);
                    if (property.guests < requiredGuests) return false;
                }

                // Amenities filter
                if (currentFilters.amenities.length > 0) {
                    const propertyAmenities = property.amenities.map(a => a.toLowerCase());
                    const hasMatchingAmenity = currentFilters.amenities.some(amenity => 
                        propertyAmenities.includes(amenity.toLowerCase())
                    );
                    if (!hasMatchingAmenity) return false;
                }

                return true;
            });

            // Display results
            displayResults(filteredProperties);
            
            // Log filtering activity
            addConsoleLog(`üîç Filtered: ${filteredProperties.length}/${sampleProperties.length} properties match criteria`);
            addConsoleLog(`üìç Active filters: ${JSON.stringify(currentFilters)}`);
        }

        function displayResults(properties) {
            const resultsDiv = document.getElementById('filterResults');
            const statsDiv = document.getElementById('filterStats');

            if (properties.length === 0) {
                resultsDiv.innerHTML = '<p style="color: #dc3545;">No properties match the selected filters.</p>';
            } else {
                resultsDiv.innerHTML = properties.map(property => `
                    <div class="property-card">
                        <div class="property-info">
                            <div class="property-name">${property.name}</div>
                            <div class="property-details">
                                üìç ${property.location} | üè† ${property.type} | üë• ${property.guests} guests | ‚≠ê ${property.amenities.join(', ')}
                            </div>
                        </div>
                        <div class="property-price">‚Çπ${property.price}</div>
                    </div>
                `).join('');
            }

            statsDiv.innerHTML = `Showing ${properties.length} of ${sampleProperties.length} properties`;
        }

        function testPriceFiltering() {
            addConsoleLog('üß™ Testing price range filtering...');
            document.getElementById('price-2000-3000').checked = true;
            updateFilters();
            addConsoleLog('‚úÖ Price filtering test completed');
        }

        function testTypeFiltering() {
            addConsoleLog('üß™ Testing property type filtering...');
            document.getElementById('type-villa').checked = true;
            updateFilters();
            addConsoleLog('‚úÖ Type filtering test completed');
        }

        function testLocationFiltering() {
            addConsoleLog('üß™ Testing location filtering...');
            document.getElementById('locationInput').value = 'Hyderabad';
            updateFilters();
            addConsoleLog('‚úÖ Location filtering test completed');
        }

        function testGuestFiltering() {
            addConsoleLog('üß™ Testing guest filtering...');
            document.getElementById('guestsSelect').value = '4';
            updateFilters();
            addConsoleLog('‚úÖ Guest filtering test completed');
        }

        function testAmenityFiltering() {
            addConsoleLog('üß™ Testing amenity filtering...');
            document.getElementById('amenity-pool').checked = true;
            updateFilters();
            addConsoleLog('‚úÖ Amenity filtering test completed');
        }

        function testCombinedFiltering() {
            addConsoleLog('üß™ Testing combined filtering...');
            document.getElementById('price-3000-4000').checked = true;
            document.getElementById('type-resort').checked = true;
            document.getElementById('locationInput').value = 'Kollam';
            document.getElementById('guestsSelect').value = '6';
            document.getElementById('amenity-pool').checked = true;
            updateFilters();
            addConsoleLog('‚úÖ Combined filtering test completed');
        }

        async function testPropertiesPage() {
            addConsoleLog('üß™ Testing properties page filtering...');
            try {
                const response = await fetch('http://localhost:8080/properties');
                if (response.ok) {
                    addConsoleLog('‚úÖ Properties page accessible');
                    addConsoleLog('üîç Test the filtering on the actual page');
                    addConsoleLog('üí∞ Try selecting price ranges and property types');
                    addConsoleLog('üìç Check console for filtering logs');
                } else {
                    addConsoleLog('‚ùå Properties page not accessible');
                }
            } catch (error) {
                addConsoleLog('‚ùå Error testing properties page');
            }
        }

        // Auto-test on page load
        window.addEventListener('load', () => {
            addConsoleLog('‚úÖ Property filtering test loaded');
            addConsoleLog('üîç Real-time filtering system active');
            addConsoleLog('üí∞ Test price ranges: Under ‚Çπ2,000, ‚Çπ2,000-‚Çπ3,000, etc.');
            addConsoleLog('üè† Test property types: Villa, Cottage, Resort, Heritage');
            addConsoleLog('üìç Test locations: Hyderabad, Bangalore, Kollam, Mumbai');
            addConsoleLog('üë• Test guest capacities: 1-9+ guests');
            addConsoleLog('‚≠ê Test amenities: Pool, WiFi, Parking, Kitchen, AC');
        });
    </script>
</body>
</html>
